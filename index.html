<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>4W Sulawesi Earthquake and Tsunami</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">

    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="style.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>

   <style>
   	#loadinggif{
	  position: fixed;
	  z-index: 9000;
	  top: 0;
	  left: 0;
	  width: 100vw;
	  height: 100vh;
	  background: rgba(0,0,0,.4);
	  text-align: center;
	  padding-top: 45vh;
	  display: none;
	}
	#loadinggif img{
		width: 50px;
	}
   </style>
  </head>

  <body>

  	<div id="loadinggif"><img src="hdx-loading.gif"></div>

  	<!-- HEADER -->
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
      <h3 class="my-0 mr-md-auto font-weight-bold">4W Central Sulawesi Earthquake and Tsunami 2018</h3>
      <nav class="my-2 my-md-0 mr-md-3">
      	<h4 class="button" font-weight= 'bold' id="resetall">Clear Filter</h4>
      </nav>
    </div>
    <!-- END HEADER -->


    <!-- START Page Content -->
    <div class="container-fluid" id='maincontainer'>
    	<div class="row">

        	<!-- CENTER PANEL -->

        	<div class="col-12">
    			<div class="col-md-12 apanel">
	    			<div class="row">
	    			<div class="row blockrow">
	    				<div class="col-md-12" style="text-align: left;">
	    					<p class="pmap">The visualisation shows the status of ongoing humanitarian response for Central Sulawesi Earthquake and Tsunami. The data was based on the 4w data received by OCHA and AHA Centre from the lead cluster / sectors agencies. The Visualisation shows Sector activities at Sub district level.<br>
	    					The Visualisation was done based on a collaboration work by OCHA, AHA Centre, HDX and Pulse Lab Jakarta.
	    					</p>
	    				</div>
		            </div>
		                
	    				<div class="col-2 blockmaptop">
	    					<font class="blockmaptop_title">
		    					<i class="" aria-hidden="true"></i>&nbsp;
		    					Organisations
		    				</font>
	    					<h4 id='val1'>
	    						<!-- generated by f_getBlockInfo() -->
	    					</h4>
	    				</div>
	    				<div class="col-2 blockmaptop">
		    				<font class="blockmaptop_title">
		    					<i class="" aria-hidden="true"></i>&nbsp;
		    					Activities
		    				</font>
		    				<h4 id='val2'>
		    					<!-- generated by f_getBlockInfo() -->
		    				</h4>
		    			</div>
	    				<div class="col-2 blockmaptop">
	    					<font class="blockmaptop_title">
	    						<i class="" aria-hidden="true"></i>&nbsp;
	    						Location
	    					</font>
	    					<h4 id='val3'>
	    						<!-- generated by f_getBlockInfo() -->
	    					</h4>
	    				</div>
	    				<div class="col-3 blockmaptop" style="border-right:0px">
		    				<font class="blockmaptop_title">
		    					<i class="" aria-hidden="true"></i>&nbsp;
	    						Select Period
	    					</font>
	    					<center>
	    						<select class="form-control" id="periodselect" data-default ="0">
	    						</select>     
	    					</center>
	    				</div>
	    				<div class="col-3 blockmaptop" style="border-right:0px">
		    				<font class="blockmaptop_title">
		    					<i class="" aria-hidden="true"></i>&nbsp;
	    						Select Sub-district
	    					</font>
	    					<center>
	    						<select class="form-control" id="regionselect" data-default ="0">
	    							<option value='0'>ALL SUB DISTRICT</option>
	    						</select>     
	    					</center>
	    				</div>
	    				
	    			</div>

	    		</div>
	    		<div class="col-md-12 apanel">
	    			<div class="row">
	    				<div class="col-md-6">
	    					<div id='regions_div'></div>
	    				</div>
	    				<div class="col-md-6">
	    					<div class="row">
	    						<div class="col-md-6">
				    				<div class="col-md-12 paneltitle">
					    				<font class="panelTitleLight">Type of &nbsp;</font><font class="panelTitleBold">Organizations</font>
					    			</div>
					    			<div id="pieOrg"></div>
					    		</div>
					    		<div class="col-md-6">
				    				<div class="col-md-12 paneltitle">
					    				<font class="panelTitleLight">Activity &nbsp;</font><font class="panelTitleBold">Status</font>
					    			</div>
					    			<div id="pieStat"></div>
					    		</div>
					    		<div class="col-md-12" style="margin-top: 3rem">
				    				<div class="col-md-12 paneltitle">
					    				<font class="panelTitleLight">Type of &nbsp;</font><font class="panelTitleBold">Sector</font>
					    			</div>
					    			<div id="barSect"></div>
					    		</div>
	    					</div>
	    				</div>
	    				
	    			</div>
	    				
	    		</div>
	    	</div>
    		
    		<div class="col-md-12 hidewhenmobile order-md-4" style="margin-top: 2rem">
    			<left>
	    			<p class="pmap">The information is based on the latest compilation report by OCHA and AHA Centre. Listed activities are only taken from the report that includes minimum information that can be mapped. Will be updated on weekly basis.
					</p>
				</center>
	    		<div class="col-md-12 apanel" style="margin-top: 10px;">
	    			<div class="row">
		    			<div class="col-md-12">
		    				<table id="datatable" class="table table-striped table-bordered table-hover"></table>
		    			</div>
		    		</div>
	    		</div>
	    	</div>

    	</div>
    </div>
    <!-- END Page Content -->
    <br/><br/>


    <!-- JAVASCRIPT LIBRARY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
   integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
   crossorigin=""></script>

   

    <script type="text/javascript">
    	$(document).ready(function(){

    		// INITIAL VARIABLE
    		var thedata,
    			theDataTableInit = 0,
    			human_number = d3.format(",d"),
    			SelectedRegion = 'Sub Dstrict',
    			statesData = 0,
    			locationCount = [],
    			reportingperiod = [],
    			organisationCount = [],
    			statusCount = [],
    			sectorCount = [],
    			orgtotal = 0,
    			periodselect = 0,
    			zero = 0;
    			regionselect = 0;


			var geojson;
			var map = L.map('regions_div').setView([-0.38657508005103247, 120.32763303281251], 8);
			var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				maxZoom: 15,
				attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			});
			OpenStreetMap_Mapnik.addTo(map);




    		// function to draw the map
    		function drawregiondiv(){
    			
    			// control that shows state info on hover
				var info = L.control();

				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info');
					this.update();
					return this._div;
				};

				info.update = function (props) {
					
					this._div.innerHTML = '<h5>Organisation Activities by Sub District</h5>' +  (props ?
						'<b>' + props.KECAMATAN + '</b><br />' + locationCount[props.KECAMATAN] + ' Activities'
						: 'Hover over a state');
				};

				info.addTo(map);


				// get color depending on population density value
				function getColor(d) {
					return 	d > 50  ? '#157A72' :
							d > 20  ? '#1B9D93' :
							d > 10  ? '#20BFB3' :
							d > 5   ? '#48CAC0' :
							d > 1   ? '#85DCD5' :
										'transparent';
				}

				function style(feature) {
					return {
						weight: 1,
						opacity: 1,
						color: 'white',
						dashArray: '3',
						fillOpacity: 0.7,
						fillColor: getColor(locationCount[feature.properties.KECAMATAN]) 
					};
				}

				function highlightFeature(e) {
					var layer = e.target;

					layer.setStyle({
						weight: 5,
						color: '#666',
						dashArray: '',
						fillOpacity: 0.7
					});

					if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
						layer.bringToFront();
					}

					info.update(layer.feature.properties);
				}


				function resetHighlight(e) {
					geojson.resetStyle(e.target);
					info.update();
				}

				function zoomToFeature(e) {
					// map.fitBounds(e.target.getBounds());
					let kec = e.target.feature.properties.KECAMATAN;
					let select = kec.replace(' ','-');
					$('#regionselect option').removeAttr('selected').filter('[value=' + select + ']').attr('selected', true);
					redrawvis(kec);
				}

				function onEachFeature(feature, layer) {
					layer.on({
						mouseover: highlightFeature,
						mouseout: resetHighlight,
						click: zoomToFeature
					});
				}

				geojson = L.geoJson(statesData, {
					style: style,
					onEachFeature: onEachFeature
				}).addTo(map);

				map.attributionControl.addAttribution('3W Data &copy; Compile by OCHA and AHA Centre');


				var legend = L.control({position: 'bottomright'});

				legend.onAdd = function (map) {

					var div = L.DomUtil.create('div', 'info legend'),
						grades = [1, 5, 10, 20, 50],
						labels = [],
						from, to;

					for (var i = 0; i < grades.length; i++) {
						from = grades[i];
						to = grades[i + 1];

						labels.push(
							'<i style="background:' + getColor(from + 1) + '"></i> ' +
							from + (to ? '&ndash;' + to : '+'));
					}

					div.innerHTML = labels.join('<br>');
					return div;
				};

				legend.addTo(map);
	    	}

	    	function f_drawPieOrg(){
	    		var thedata = [['Type Org', 'Total']];
	    		for(x in organisationCount){
	    			thedata.push([x,organisationCount[x]])
	    		}

	    		// Load google charts
				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart);

				// Draw the chart and set the chart values
				function drawChart() {
				  var data = google.visualization.arrayToDataTable(thedata);

				  // Optional; add a title and set the width and height of the chart
				  var options = {
				  	legend: 'none',
			        pieSliceText: 'label',
			        pieStartAngle: 100,
			        colors: ['#157A72', '#1B9D93', '#20BFB3', '#48CAC0', '#85DCD5'],
			        chartArea:{
			        	left:0,
			        	top:10,
			        	bottom:10,
			        	width:'100%',
			        	height:'100%'
			        }
			      };

				  // Display the chart inside the <div> element with id="piechart"
				  var chart = new google.visualization.PieChart(document.getElementById('pieOrg'));
				  chart.draw(data, options);
				  google.visualization.events.addListener(chart, 'select', function() {
					  var sel = chart.getSelection()[0].row;
					  redrawbaseorg(thedata[sel+1][0]);
				  });
				}
	    	}
				
			function f_drawPieStat(){
	    		var thedata = [['Status', 'Total']];
	    		for(x in statusCount){
	    			thedata.push([x,statusCount[x]])
	    		}

	    		// Load google charts
				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart);

				// Draw the chart and set the chart values
				function drawChart() {
				  var data = google.visualization.arrayToDataTable(thedata);

				  // Optional; add a title and set the width and height of the chart
				  var options = {
				  	legend: 'none',
			        pieSliceText: 'label',
			        pieStartAngle: 100,
			        colors: ['#20BFB3', '#1B9D93', '#85DCD5'],
			        chartArea:{
			        	left:0,
			        	top:10,
			        	bottom:10,
			        	width:'100%',
			        	height:'100%'
			        },
			      };

				  // Display the chart inside the <div> element with id="piechart"
				  var chart = new google.visualization.PieChart(document.getElementById('pieStat'));
				  chart.draw(data, options);
				  google.visualization.events.addListener(chart, 'select', function() {
					  var sel = chart.getSelection()[0].row;
					  redrawbasestat(thedata[sel+1][0]);
				  });
				}
	    	}		

	    	function f_drawBarSect(){
	    		var head = ['Sector', 'Total',{type: 'string', role: 'annotation'}];
	    		var thedata = [];
	    		for(x in sectorCount){
	    			thedata.push([x,sectorCount[x],sectorCount[x]])
	    		}
	    		thedata.sort(sortFunction);

				function sortFunction(a, b) {
				    if (a[1] === b[1]) {
				        return 0;
				    }
				    else {
				        return (a[1] > b[1]) ? -1 : 1;
				    }
				}
				thedata.unshift(head);

	    		google.charts.load('current', {packages: ['corechart', 'bar']});
				google.charts.setOnLoadCallback(drawBasic);

				function drawBasic() {

				      var data = google.visualization.arrayToDataTable(thedata);

				      var options = {
				      	colors:['#20bfb3'],
				      	height:350,
				        chartArea: {width: '85%',top:5,right:3 ,bottom:40},
				        legend: 'none',
				        
				        hAxis: {
				          title: 'Total Activities',
				          minValue: 0
				        },
				        //vAxis: {
				          //title: 'Sectors'
				       //},
				        annotations: {
				          alwaysOutside: true,
				          textStyle: {
				            fontSize: 12,
				            auraColor: 'none',
				            color: '#555'
				          },
				          boxStyle: {
				            stroke: '#ccc',
				            strokeWidth: 1,
				            gradient: {
				              color1: '#f3e5f5',
				              color2: '#f3e5f5',
				              x1: '0%', y1: '0%',
				              x2: '100%', y2: '100%'
				            }
				          }
				        },
				        animation:{
					        duration: 1000,
					        easing: 'out',
					        startup: true
					    },
				      };

				      var chart = new google.visualization.BarChart(document.getElementById('barSect'));

				      chart.draw(data, options);
				      google.visualization.events.addListener(chart, 'select', function() {
						  var sel = chart.getSelection()[0].row;
						  redrawbasesector(thedata[sel+1][0]);
					  });
				    }
	    	}	


	    	// function to draw the data table
	    	function f_drawDataTable(data){
	    		if(theDataTableInit){
	    			theDataTableInit.destroy();
	    		}

	    		var thedatasource = [];
	    		$.each(data,function(i,z){

	    			newdata = [	z['Implementing Agency'],
	    						z['Lead Organization'],
	    						z['Org Type'],
	    						z['District'],
	    						z['Sub Dstrict'],
	    						//z['Village'],
	    						//z['Admin Level 5'],
	    						z['Sector/Cluster'],
	    						z['Sub Sector'],
	    						z['Status'],
	    						z['Activity Details'],
	    						//z['Start Date'],
	    						//z['End Date'],
	    						//z['Total Beneficiaries Reached'],
	    						//z['Total Beneficiaries Planned'],
	    						z['Primary Beneficiary Type'],
	    						z['# of Primary Beneficiaries'],
	    						//z['Activity Description'],
	    						//z['Material Provided'],
	    					];
	    			
    				thedatasource.push(newdata);
    			});


	    		theDataTableInit = $('#datatable').DataTable( {
	    			data: thedatasource,
			        columns: [
			            { title: "Implementing Agency" },
			            { title: "Lead Organization"},
			            { title: "Org Type" },
			            { title: "District" },
			            { title: "Sub Dstrict" },
			            //{ title: "Village" },
			            //{ title: "Admin Level 5" },
			            { title: "Sector/Cluster" },
			            { title: "Sub Sector" },
			            { title: "Status" },
			            { title: "Activity Details"},
			            //{ title: "Start Date" },
			            //{ title: "End Date" },
			            //{ title: "Total Beneficiaries Reached"},
			            //{ title: "Total Beneficiaries Planned" },
			            { title: "Primary Beneficiary Type" },
			            { title: "# of Primary Beneficiaries" },
			            //{ title: "Activity Description" },
			            //{ title: "Material Provided" },
			            
			        ],
			        responsive: true,
			        
				    
			    } );
	    	}

	    	$('#regionselect').on('change',function(){
	    		var val = $(this).val();
	    		let select = val.replace('-',' ');
	    		regionselect = select;
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			if(val == 0){
		    			redrawvis(val);
		    		}else{
		    			redrawvis(select);

		    		}
	    			$('#loadinggif').hide();
	    		},500)
	    	})

	    	$('#periodselect').on('change',function(){
	    		$('#loadinggif').show();
	    		var val = $(this).val();
	    		periodselect = val;
	    		setTimeout(function(){
	    			redrawvisbasedonperiod(periodselect);
	    			$('#loadinggif').hide();
	    		},500)
	    	})

	    	$('#resetall').on('click',function(){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			redrawvisbasedonperiod(0)
	    			$('#loadinggif').hide();
	    		},500)
	    	})

	    	function redrawvisbasedonperiod(theperiod){
	    		map.removeLayer(geojson);
	    		$('.info').remove();
	    		var therepper = 0;

    			organisationCount = [];
    			statusCount = [];
    			sectorCount = [];
    			locationCount=[];
    			datatblnew = [];
    			orgtotal=[];
    			$('#regionselect').html('');
    			$('#regionselect').append('<option value="0">ALL SUB DISTRICT</option>');

    			if(theperiod == 0){
    				reportingperiod = [];
    				$('#periodselect').html('');
	    			thedata.forEach(function(d){
	    				let repper = d['Reporting period'];
		    			if(!reportingperiod[repper]){
		    				reportingperiod[repper] = repper;
		    				therepper = repper;
		    				$('#periodselect').append('<option class="periodselect" selected="true" value="'+repper+'">'+repper+'</option>');
		    				$('#periodselect option[value="'+repper+'"]').prop("selected",true);
		    			}
		    			theperiod = therepper;
		    		});
    			}
    			
	    		thedata.forEach(function(d){
	    			if(d['Reporting period'] == theperiod){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}
		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
		    		}
	    			
	    		})
	    		periodselect = theperiod;

	    		drawregiondiv();
	    		f_drawPieOrg();
	    		f_drawPieStat();
	    		f_drawBarSect();
	    		f_drawDataTable(datatblnew);

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in locationCount){
	    			val3++;
	    			val2+=locationCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    	}

	    	function redrawvis(namakecamatan){
	    		$('#loadinggif').show();
	    		map.removeLayer(geojson);
	    		$('.info').remove();

    			organisationCount = [];
    			statusCount = [];
    			sectorCount = [];
    			locationCount=[];
    			datatblnew = [];
    			orgtotal=[];

	    		thedata.forEach(function(d){
	    			if(namakecamatan == '0' && periodselect == d['Reporting period'] ){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				// let select = tempat.replace(' ','-');
		    				// $('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
	    			}
	    			else if(d['Sub Dstrict'].toUpperCase() == namakecamatan.toUpperCase() && periodselect == d['Reporting period']){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				// let select = tempat.replace(' ','-');
		    				// $('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}
		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
		    		}
	    			
	    		})

	    		drawregiondiv();
	    		f_drawPieOrg();
	    		f_drawPieStat();
	    		f_drawBarSect();
	    		f_drawDataTable(datatblnew);

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in locationCount){
	    			val3++;
	    			val2+=locationCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    		$('#loadinggif').hide();
	    	}

	    	function redrawbasestat(stat){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			run();
	    			$('#loadinggif').hide();
	    		},500)

	    		function run(){
	    			map.removeLayer(geojson);
		    		$('.info').remove();
		    		
		    		organisationCount = [];
	    			datatblnew = [];
	    			locationCount = [];
	    			orgtotal=[];
	    			sectorCount=[];

	    			console.log(periodselect);
	    			console.log(regionselect);

		    		thedata.forEach(function(d){
		    			if( d['Sub Dstrict'].toUpperCase() == regionselect){
		    				console.log(d['Sub Dstrict'].toUpperCase())
		    			}
		    			if(d['Status'].toUpperCase() == stat && d['Reporting period'] == periodselect && (regionselect == 0 || regionselect == d['Sub Dstrict'].toUpperCase()) ){
		    				datatblnew.push(d);
		    				let tempat = d['Sub Dstrict'].toUpperCase();
			    			if(locationCount[tempat]){
			    				locationCount[tempat] += 1;
			    			}else{
			    				locationCount[tempat] = 1;
			    				let select = tempat.replace(' ','-');
			    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
			    			}

			    			let orgtype = d['Org Type'].toUpperCase();
			    			if(organisationCount[orgtype]){
			    				organisationCount[orgtype] += 1;
			    			}else{
			    				organisationCount[orgtype] = 1;
			    			}

			    			let org=d['Implementing Agency'];
			    			let cek = $.inArray( org, orgtotal ); 
			    			if(cek == -1){
			    				orgtotal.push(org);
			    			}

			    			let sectortype = d['Sector/Cluster'].toUpperCase();
			    			if(sectorCount[sectortype]){
			    				sectorCount[sectortype] += 1;
			    			}else{
			    				sectorCount[sectortype] = 1;
			    			}
		    			}
		    		})

		    		drawregiondiv();
		    		f_drawPieOrg();
		    		f_drawDataTable(datatblnew);
		    		f_drawBarSect();

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in locationCount){
		    			val3++;
		    			val2+=locationCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    		}
	    	}

	    	function redrawbaseorg(org){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			run();
	    			$('#loadinggif').hide();
	    		},500)
	    		function run(){
	    			map.removeLayer(geojson);
		    		$('.info').remove();
		    		
	    			datatblnew = [];
	    			locationCount = [];
	    			orgtotal=[];
	    			sectorCount=[];
	    			statusCount = [];

		    		thedata.forEach(function(d){
		    			if(d['Org Type'].toUpperCase() == org && d['Reporting period'] == periodselect && (regionselect == 0 || regionselect == d['Sub Dstrict'].toUpperCase())){
		    				datatblnew.push(d);
		    				let tempat = d['Sub Dstrict'].toUpperCase();
			    			if(locationCount[tempat]){
			    				locationCount[tempat] += 1;
			    			}else{
			    				locationCount[tempat] = 1;
			    				let select = tempat.replace(' ','-');
			    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
			    			}

			    			let org=d['Implementing Agency'];
			    			let cek = $.inArray( org, orgtotal ); 
			    			if(cek == -1){
			    				orgtotal.push(org);
			    			}

			    			let sectortype = d['Sector/Cluster'].toUpperCase();
			    			if(sectorCount[sectortype]){
			    				sectorCount[sectortype] += 1;
			    			}else{
			    				sectorCount[sectortype] = 1;
			    			}

			    			let stattype = d['Status'].toUpperCase();
			    			if(stattype!=''){
			    				if(statusCount[stattype]){
				    				statusCount[stattype] += 1;
				    			}else{
				    				statusCount[stattype] = 1;
				    			}
			    			}
		    			}
		    		})

		    		drawregiondiv();
		    		f_drawDataTable(datatblnew);
		    		f_drawBarSect();
		    		f_drawPieStat();

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in locationCount){
		    			val3++;
		    			val2+=locationCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    		}
	    	}

	    	function redrawbasesector(sector){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			run();
	    			$('#loadinggif').hide();
	    		},500)
	    		function run(){
	    			map.removeLayer(geojson);
		    		$('.info').remove();
		    		
		    		organisationCount = [];
	    			statusCount = [];
	    			datatblnew = [];
	    			locationCount = [];
	    			orgtotal=[];

		    		thedata.forEach(function(d){
		    			if(d['Sector/Cluster'].toUpperCase() == sector && d['Reporting period'] == periodselect && (regionselect == 0 || regionselect == d['Sub Dstrict'].toUpperCase())){
		    				datatblnew.push(d);
		    				let tempat = d['Sub Dstrict'].toUpperCase();
			    			if(locationCount[tempat]){
			    				locationCount[tempat] += 1;
			    			}else{
			    				locationCount[tempat] = 1;
			    				let select = tempat.replace(' ','-');
			    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
			    			}


			    			let orgtype = d['Org Type'].toUpperCase();
			    			if(organisationCount[orgtype]){
			    				organisationCount[orgtype] += 1;
			    			}else{
			    				organisationCount[orgtype] = 1;
			    			}

			    			let stattype = d['Status'].toUpperCase();
			    			if(stattype!=''){
			    				if(statusCount[stattype]){
				    				statusCount[stattype] += 1;
				    			}else{
				    				statusCount[stattype] = 1;
				    			}
			    			}

			    			let org=d['Implementing Agency'];
			    			let cek = $.inArray( org, orgtotal ); 
			    			if(cek == -1){
			    				orgtotal.push(org);
			    			}
		    			}
		    		})

		    		drawregiondiv();
		    		f_drawPieOrg();
		    		f_drawPieStat();
		    		f_drawDataTable(datatblnew);

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in locationCount){
		    			val3++;
		    			val2+=locationCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    		}
	    	}

	    	function drawinit(){
	    		orgtotal=[];
	    		var therepper = 0;
	    		thedata.forEach(function(d){
		    			let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let repper = d['Reporting period'];
		    			if(!reportingperiod[repper]){
		    				reportingperiod[repper] = repper;
		    				therepper = repper;
		    				$('#periodselect').append('<option class="periodselect" selected="true" value="'+repper+'">'+repper+'</option>');
		    				$('#periodselect option[value="'+repper+'"]').prop("selected",true);
		    			}

		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}
		    			
		    			
		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
		    	});


		    		drawregiondiv();
		    		// f_drawPieOrg();
		    		// f_drawPieStat();
		    		// f_drawBarSect();
		    		// f_drawDataTable(thedata);
		    		periodselect = therepper;
		    		redrawvisbasedonperiod(therepper)

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in locationCount){
		    			val3++;
		    			val2+=locationCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    	}

	    	$('#loadinggif').show();
		    d3.json('idn_admin03_central_sulawesi_bnpb.geojson',function(jso){	
	    		statesData = jso;
	    		//call the original data
	    		d3.csv('4w_centralsulawesi_master.csv',function(data){
		    		//set the data called to variable thedata
		    		thedata = data;

		    		drawinit();
		    		$('#loadinggif').hide();
		    	})	    	


	    	})


    	})
    	
    </script>


  </body>

</html>
